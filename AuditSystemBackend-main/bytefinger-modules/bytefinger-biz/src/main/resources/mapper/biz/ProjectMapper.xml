<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bytefinger.toutuo.biz.project.mapper.ProjectMapper">

    <sql id="selectBaseData">
        SELECT
            DISTINCT project.*
        FROM
            biz_project project
            where 1=1
        and (1 != 1 or
               (
                   1 = 1
                   <if test="cm.serviceStatus != null and cm.serviceStatus.size>0" >
                       and (1!=1
                       <foreach collection="cm.serviceStatus" index="index" item="item" open="" separator=" " close="">
                           <if test="item == 'WEI_JIE_XIANG' ">
                               or project.service_status not in ('ZAI_GUAN','YI_FEI_ZHI','YI_ZHONG_ZHI','YI_WAN_JIE','YI_TUI_CHANG','CLOSE_FILE','WEI_ZHONG_BIAO')
                           </if>
                           <if test="item != 'WEI_JIE_XIANG' ">
                               or project.service_status = #{item}
                           </if>
                       </foreach>
                       )
                   </if>
                   <if test="cm.serviceStatus == null or cm.serviceStatus.size == 0" >
                       and 1 != 1
                   </if>
                   <if test="cm.isRenewalTender != null">
                       <if test="cm.isRenewalTender == 'SHI'">
                          AND project.id in  (
                          select relevance_project_id from biz_project_extension where process_mode in (1,2) and relevance_project_id is not null
                          )
                       </if>
                       <if test="cm.isRenewalTender == 'FOU'">
                          AND project.id not in  (
                          select relevance_project_id from biz_project_extension where process_mode in (1,2) and relevance_project_id is not null
                          )
                       </if>
                   </if>

              ) or (

                    <if test="cm.expandServiceStatus != null and cm.expandServiceStatus.size>0" >
                        ( 1!=1
                         <foreach collection="cm.expandServiceStatus" index="index" item="item" open="" separator=" " close="">
                             <if test="item == 'WEI_JIE_XIANG' ">
                                 or project.service_status not in ('ZAI_GUAN','YI_FEI_ZHI','YI_ZHONG_ZHI','YI_WAN_JIE','YI_TUI_CHANG','CLOSE_FILE','WEI_ZHONG_BIAO')
                             </if>
                             <if test="item != 'WEI_JIE_XIANG' ">
                                 or project.service_status = #{item}
                             </if>
                         </foreach>
                        )
                        <if test="cm.updateStatusDateStart != null">
                            and project.update_status_date >= #{cm.updateStatusDateStart}
                        </if>

                        <if test="cm.updateStatusDateEnd != null">
                            and #{cm.updateStatusDateEnd} >= project.update_status_date
                        </if>
                    </if>

                    <if test="cm.expandServiceStatus == null or cm.expandServiceStatus.size == 0" >
                         1 != 1
                    </if>
              )
        )

        <if test="cm.expandCompanyId != null and cm.expandCompanyId.size>0" >
        and project.id in (
            select project_id from biz_project_achievement where expand_company_id in
            <foreach collection="cm.expandCompanyId" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
         )
        </if>
        <if test="cm.finishStepId != null and cm.finishStepId.size>0" >
            and project.id in (
            select project_id from biz_project_step where step_menu_id in
            <foreach collection="cm.finishStepId" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
            and status = 1
            )
        </if>
        <choose>
            <!--  所在部门及下级部门+员工   -->
            <when test="'SHOW_SUB' == cm.dataRole">
                <!-- 我部门下的数据 -->
                and (
                project.company_id IN
                <foreach collection="cm.deptIds" index="index" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
                OR project.id IN ( SELECT bpu.record_id FROM biz_project_team bpu WHERE bpu.user_id = #{cm.userId})
                OR project.attributor_user_id = #{cm.userId}
                OR project.create_user_id = #{cm.userId}
                )
            </when>

            <!-- 全部数据 -->
            <when test="'SHOW_ALL' == cm.dataRole">

            </when>

            <!-- 默认本人数据 -->
            <otherwise>
                AND (
                project.attributor_user_id = #{cm.userId}
                OR project.id IN ( SELECT bpu.record_id FROM biz_project_team bpu WHERE bpu.user_id = #{cm.userId})
                OR project.create_user_id = #{cm.userId}
                )
            </otherwise>
        </choose>
    </sql>
    <sql id="selectBaseDataAll">
         SELECT
            DISTINCT project.*
        FROM
            biz_project project
            where 1=1
        <choose>
            <!--  所在部门及下级部门+员工   -->
            <when test="'SHOW_SUB' == cm.dataRole">
                <!-- 我部门下的数据 -->
                and (
                project.company_id IN
                <foreach collection="cm.deptIds" index="index" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
                OR project.id IN ( SELECT bpu.record_id FROM biz_project_team bpu WHERE bpu.user_id = #{cm.userId})
                OR project.attributor_user_id = #{cm.userId}
                OR project.create_user_id = #{cm.userId}
                )
            </when>

            <!-- 全部数据 -->
            <when test="'SHOW_ALL' == cm.dataRole">

            </when>

            <!-- 默认本人数据 -->
            <otherwise>
                AND (
                project.attributor_user_id = #{cm.userId}
                OR project.id IN ( SELECT bpu.record_id FROM biz_project_team bpu WHERE bpu.user_id = #{cm.userId})
                OR project.create_user_id = #{cm.userId}
                )
            </otherwise>
        </choose>
    </sql>

    <sql id="selectBaseDataFromCustomer">
        SELECT
        DISTINCT project.*
        FROM
        biz_project project
        where 1=1

        <choose>
            <!--  所在部门及下级部门+员工   -->
            <when test="'SHOW_SUB' == cm.dataRole">
                <!-- 我部门下的数据 -->
                and (
                project.company_id IN
                <foreach collection="cm.deptIds" index="index" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
                OR project.id IN ( SELECT bpu.record_id FROM biz_project_team bpu WHERE bpu.user_id = #{cm.userId})
                OR project.attributor_user_id = #{cm.userId}
                OR project.create_user_id = #{cm.userId}
                )
            </when>

            <!-- 全部数据 -->
            <when test="'SHOW_ALL' == cm.dataRole">

            </when>

            <!-- 默认本人数据 -->
            <otherwise>
                AND (
                project.attributor_user_id = #{cm.userId}
                OR project.id IN ( SELECT bpu.record_id FROM biz_project_team bpu WHERE bpu.user_id = #{cm.userId})
                OR project.create_user_id = #{cm.userId}
                )
            </otherwise>
        </choose>
    </sql>

    <sql id="selectBaseDataTwo">
        SELECT
        DISTINCT project.*
        FROM
        (select project.*,
        bpa.expand_company_id,
        bpa.assignment_rate,bpa.assignment_desc
        from  biz_project project
        left join  biz_project_step bps on project.id= bps.project_id
        left join  biz_project_achievement bpa on project.id=bpa.project_id

        where
        bps.step_menu_id=18
        and bps.status=1
        and project.project_type in ('DAN_YI_FEI_TOU_BIAO_XIANG_MU','DAN_YI_TOU_BIAO_XIANG_MU')


        ) project
        where 1=1
        and (1 != 1 or
        (
        1 = 1
        <if test="cm.serviceStatus != null and cm.serviceStatus.size>0" >
            and (1!=1
            <foreach collection="cm.serviceStatus" index="index" item="item" open="" separator=" " close="">
                <if test="item == 'WEI_JIE_XIANG' ">
                    or project.service_status not in ('ZAI_GUAN','YI_FEI_ZHI','YI_ZHONG_ZHI','YI_WAN_JIE','YI_TUI_CHANG','CLOSE_FILE','WEI_ZHONG_BIAO')
                </if>
                <if test="item != 'WEI_JIE_XIANG' ">
                    or project.service_status = #{item}
                </if>
            </foreach>
            )
        </if>
        <if test="cm.serviceStatus == null or cm.serviceStatus.size == 0" >
            and 1 != 1
        </if>
        <if test="cm.isRenewalTender != null">
            <if test="cm.isRenewalTender == 'SHI'">
                AND project.id in  (
                select relevance_project_id from biz_project_extension where process_mode in (1,2) and relevance_project_id is not null
                )
            </if>
            <if test="cm.isRenewalTender == 'FOU'">
                AND project.id not in  (
                select relevance_project_id from biz_project_extension where process_mode in (1,2) and relevance_project_id is not null
                )
            </if>
        </if>

        ) or (

        <if test="cm.expandServiceStatus != null and cm.expandServiceStatus.size>0" >
            ( 1!=1
            <foreach collection="cm.expandServiceStatus" index="index" item="item" open="" separator=" " close="">
                <if test="item == 'WEI_JIE_XIANG' ">
                    or project.service_status not in ('ZAI_GUAN','YI_FEI_ZHI','YI_ZHONG_ZHI','YI_WAN_JIE','YI_TUI_CHANG','CLOSE_FILE','WEI_ZHONG_BIAO')
                </if>
                <if test="item != 'WEI_JIE_XIANG' ">
                    or project.service_status = #{item}
                </if>
            </foreach>
            )
            <if test="cm.updateStatusDateStart != null">
                and project.update_status_date >= #{cm.updateStatusDateStart}
            </if>

            <if test="cm.updateStatusDateEnd != null">
                and #{cm.updateStatusDateEnd} >= project.update_status_date
            </if>
        </if>

        <if test="cm.expandServiceStatus == null or cm.expandServiceStatus.size == 0" >
            1 != 1
        </if>
        )
        )

        <if test="cm.expandCompanyId != null and cm.expandCompanyId.size>0" >
            and project.id in (

            select project_id from biz_project_achievement where expand_company_id in
            <foreach collection="cm.expandCompanyId" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>

            )
        </if>
        <choose>
            <!--  所在部门及下级部门+员工   -->
            <when test="'SHOW_SUB' == cm.dataRole">
                <!-- 我部门下的数据 -->
                and (
                project.company_id IN
                <foreach collection="cm.deptIds" index="index" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
                OR project.id IN ( SELECT bpu.record_id FROM biz_project_team bpu WHERE bpu.user_id = #{cm.userId})
                OR project.attributor_user_id = #{cm.userId}
                OR project.create_user_id = #{cm.userId}
                )
            </when>

            <!-- 全部数据 -->
            <when test="'SHOW_ALL' == cm.dataRole">

            </when>

            <!-- 默认本人数据 -->
            <otherwise>
                AND (
                project.attributor_user_id = #{cm.userId}
                OR project.id IN ( SELECT bpu.record_id FROM biz_project_team bpu WHERE bpu.user_id = #{cm.userId})
                OR project.create_user_id = #{cm.userId}
                )
            </otherwise>
        </choose>
    </sql>

    <select id="listActualInMonth" resultType="com.bytefinger.toutuo.biz.performance.domain.ActualInMonth">
        SELECT
        *
        FROM
        biz_actual_in_month baim
        WHERE baim.record_id = #{recordId}

        <if test="null != months and months.size > 0">
            AND baim.field_name IN
            <foreach collection="months" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        ORDER BY baim.field_year, baim.field_month
    </select>

    <!-- 实际收入列表查询 -->
    <select id="listByActualIn" resultType="com.bytefinger.toutuo.biz.performance.domain.BO.ProjectActualBO">
        SELECT
        bp.id id,
        bp.enter_time enterTime,
        bp.cooperation_mode cooperationMode,
        bp.project_name projectName,
        bp.construction_area as constructionArea,
        bp.sign_time signTime,
        bp.service_begin_time serviceStarttime,
        bp.performance_confirm_time as performanceConfirmTime,
        bp.service_end_time serviceEndtime,
        bp.contract_amount contractAmount,
        bp.contract_annual_amount contractAnnualAmount,
        bp.annual_conversion_amount annualConversionAmount,
        bp.construction_area constructionArea,
        bp.proposed_service_period as proposedServicePeriod
        FROM
        biz_project bp
        <!--INNER JOIN biz_project_contract bpa ON ( bp.id = bpa.project_id ) -->
        WHERE bp.in_stock = 'FOU'
          and bp.expire = 'YOU_XIAO'
          and bp.service_status not in  ('YI_ZHONG_ZHI')
          and bp.source_id is null
          and bp.performance_confirm_time is not null
          and bp.project_type in('DAN_YI_FEI_TOU_BIAO_XIANG_MU','DAN_YI_TOU_BIAO_XIANG_MU')

        <if test="cm.userId != null">
            AND (
            bp.attributor_user_id = #{cm.userId}
            OR bp.id IN ( SELECT bpu.record_id FROM biz_project_team bpu WHERE bpu.user_id = #{cm.userId})
            )
        </if>

        <if test="ew.sqlSegment != '' ">
            AND ${ew.sqlSegment}
        </if>
    </select>

    <!-- 实际签约汇总报表 -->
    <select id="getActualInSummaryList" resultType="com.bytefinger.toutuo.biz.project.domain.Project">
        select  project.*,projectExpand.second_party secondParty
        from biz_project project
        left join biz_project_expand projectExpand on project.id = projectExpand.project_id
        where
        project.id in (
            select project_id from  biz_project_step where Status=1 and step_menu_id=18
        )
        and project.expire = 'YOU_XIAO'
        and project.service_status!='YI_FEI_ZHI'
        <!--剔除补录项目且计算业绩为否的项目 -->
        and project.is_count_performance != 'FOU'
        <!--是否多个拓展单位-->
        <if test="cm.hasExpandCompanys != null">
            <if test="cm.hasExpandCompanys == 'SHI'">
                and project.id in (
                select project_id from biz_project_achievement  group by project_id HAVING count(1)>1
                )
            </if>
            <if test="cm.hasExpandCompanys == 'FOU'">
                AND project.id not in  (
                    select project_id from biz_project_achievement  group by project_id HAVING count(1)>1
                )
            </if>
        </if>
        <if test="cm.inStock != null">
                AND project.in_Stock=#{cm.inStock}
        </if>

        <!--续签或重新投标-->
        <if test="cm.isRenewalTender != null">
            <if test="cm.isRenewalTender == 'SHI'">
                AND project.id in  (
                select relevance_project_id from biz_project_extension where process_mode in (1,2) and relevance_project_id is not null
                )
            </if>
            <if test="cm.isRenewalTender == 'FOU'">
                AND project.id not in  (
                select relevance_project_id from biz_project_extension where process_mode in (1,2) and relevance_project_id is not null
                )
            </if>
        </if>
        <!--拓展单位-->
        <if test="cm.expandCompanyId != null and cm.expandCompanyId.size>0" >
            and project.id in (
            select project_id from biz_project_achievement where expand_company_id in
            <foreach collection="cm.expandCompanyId" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
            )
        </if>

        <if test="ew.sqlSegment != '' ">
            AND ${ew.sqlSegment}
        </if>
        order by project.performance_confirm_time desc
    </select>

    <!-- 实际收入统计 -->
    <select id="totalByActualIn" resultType="Map">
        SELECT
            <foreach collection="months" index="index" item="item" separator=",">
                SUM(IF((DATE_FORMAT(bp.sign_time, '%Y-%m') = #{item}), bp.contract_amount, 0)) AS `SJHTZJE_${item}`
            </foreach>
            ,
            <foreach collection="months" index="index" item="item" separator=",">
                SUM(IF((DATE_FORMAT(bp.sign_time, '%Y-%m') = #{item}), bp.contract_annual_amount, 0)) AS `SJHTNDJE_${item}`
            </foreach>
            ,
            <foreach collection="months" index="index" item="item" separator=",">
                SUM(IF((DATE_FORMAT(bp.sign_time, '%Y-%m') = #{item}), bp.annual_conversion_amount, 0)) AS `SJHTDNZHSR_${item}`
            </foreach>
        FROM
        biz_project bp
        <!--    INNER JOIN biz_project_agreement bpa ON ( bp.id = bpa.project_id ) -->
        WHERE
        bp.sign_time IS NOT NULL
        and bp.in_stock = 'FOU'
        and bp.expire = 'YOU_XIAO'
        and bp.source_id is null
        and bp.performance_confirm_time is not null
        and bp.project_type in('DAN_YI_FEI_TOU_BIAO_XIANG_MU','DAN_YI_TOU_BIAO_XIANG_MU')
        and bp.service_status not in ('YI_ZHONG_ZHI')
        <if test="cm.userId != null">
            AND (
            bp.attributor_user_id = #{cm.userId}
            OR bp.id IN ( SELECT bpu.record_id FROM biz_project_team bpu WHERE bpu.user_id = #{cm.userId})
            )
        </if>

        <if test="ew.sqlSegment != '' ">
            AND ${ew.sqlSegment}
        </if>

        GROUP BY
        DATE_FORMAT(bp.sign_time, '%Y-%m')
        LIMIT 1
    </select>

    <!-- 实际有效提报统计 -->
    <select id="totalByValid" resultType="com.bytefinger.toutuo.biz.performance.domain.BO.ProjectActualBO">
        SELECT
            bp.company_id as companyId,bp.project_no as projectNo,  DATE_FORMAT(bp.create_time , '%Y-%m') as createTime
        FROM
        biz_project bp
        inner join biz_project_step step on bp.id = step.project_id
        inner join biz_project_step_menu stepmenu on step.step_menu_id = stepmenu.id
        WHERE  bp.in_stock = 'FOU'
        and bp.expire = 'YOU_XIAO'
        and bp.service_status !='YI_ZHONG_ZHI'
        and bp.source_id is null
        and bp.project_type in('DAN_YI_FEI_TOU_BIAO_XIANG_MU','DAN_YI_TOU_BIAO_XIANG_MU')
        and step.`status` = 1
        and stepmenu.`code` = 'xmps'

        <if test="cm.userId != null">
            AND (
            bp.attributor_user_id = #{cm.userId}
            OR bp.create_user_id = #{cm.userId}
            OR bp.id IN ( SELECT bpt.record_id FROM biz_project_team bpt WHERE bpt.user_id = #{cm.userId})
            )
        </if>

        <if test="ew.sqlSegment != '' ">
            AND ${ew.sqlSegment}
        </if>
    </select>

    <!-- 查询项目 -->
    <select id="listProject" resultType="com.bytefinger.toutuo.biz.performance.domain.BO.ProjectActualBO">
        SELECT
        bp.company_id as companyId,bp.project_no as projectNo,  bp.sign_time as signTime, bp.contract_amount as contractAmount, bp.contract_annual_amount as contractAnnualAmount,
        bp.service_begin_time as serviceStarttime, bp.service_end_time as serviceEndtime,bp.proposed_service_period as proposedServicePeriod,id
        FROM
        biz_project bp
        WHERE  bp.in_stock = 'FOU'
        and bp.source_id is null
        and bp.performance_confirm_time is not null
        and bp.project_type in('DAN_YI_FEI_TOU_BIAO_XIANG_MU','DAN_YI_TOU_BIAO_XIANG_MU')

        <if test="cm.userId != null">
            AND (
            bp.attributor_user_id = #{cm.userId}
            OR bp.id IN ( SELECT bpt.record_id FROM biz_project_team bpt WHERE bpt.user_id = #{cm.userId})
            )
        </if>

        <if test="ew.sqlSegment != '' ">
            AND ${ew.sqlSegment}
        </if>
    </select>

    <select id="totalByActualInCome" resultType="Map">
        SELECT
        <foreach collection="months" index="index" item="item" separator=",">
            SUM(IF((DATE_FORMAT(bp.sign_time, '%Y-%m') = #{item}), bp.contract_amount, 0)) AS `${item}`
        </foreach>
        FROM
        biz_project bp
        <!-- INNER JOIN biz_project_agreement bpa ON ( bp.id = bpa.project_id ) -->
        WHERE
        bp.sign_time IS NOT NULL

        <if test="cm.userId != null">
            AND (
            bp.attributor_user_id = #{cm.userId} OR bp.id IN ( SELECT bpu.record_id FROM biz_project_team bpu WHERE
            bpu.user_id = #{cm.userId})
            )
        </if>

        <if test="ew.sqlSegment != '' ">
            AND ${ew.sqlSegment}
        </if>
        GROUP BY
        DATE_FORMAT(bp.sign_time, '%Y-%m')
        LIMIT 1
    </select>

    <!-- 实际收入统计统计并表收入等 -->
    <select id="totalByActualInMonth" resultType="Map">
        SELECT
        <foreach collection="months" index="index" item="item" separator=",">
            SUM( IF ( ( baim.field_name = #{item} AND baim.field_key = 'ZGMJ' ), baim.field_value, 0 ) ) AS `ZGMJ_${item}`
        </foreach>
        ,
        <foreach collection="months" index="index" item="item" separator=",">
            SUM( IF ( ( baim.field_name = #{item} AND baim.field_key = 'SJBBSR' ), baim.field_value, 0 ) ) AS `SJBBSR_${item}`
        </foreach>
        FROM
        biz_project bp
            <!-- INNER JOIN biz_project_agreement bpa ON ( bp.id = bpa.project_id ) -->
        LEFT JOIN biz_actual_in_month baim ON (baim.record_id = bp.id)
        WHERE
        bp.sign_time IS NOT NULL

        <if test="cm.userId != null">
            AND (
            bp.attributor_user_id = #{cm.userId}
            OR bp.id IN ( SELECT bpu.record_id FROM biz_project_team bpu WHERE bpu.user_id = #{cm.userId})
            )
        </if>

        <if test="ew.sqlSegment != '' ">
            AND ${ew.sqlSegment}
        </if>

        GROUP BY
        DATE_FORMAT(bp.sign_time, '%Y-%m')
        LIMIT 1
    </select>

    <!-- 项目基础列表 -->
    <select id="list" resultType="com.bytefinger.toutuo.biz.project.domain.Project">
        <include refid="selectBaseData"></include>
        <if test="ew.sqlSegment != '' ">
            AND ${ew.sqlSegment}
        </if>
    </select>

    <select id="projectPageFromCustomer" resultType="com.bytefinger.toutuo.biz.project.domain.Project">
        <include refid="selectBaseDataFromCustomer"></include>
        <if test="ew.sqlSegment != '' ">
            AND ${ew.sqlSegment}
        </if>
    </select>

    <select id="selectProjectAchievement"
            resultType="com.bytefinger.toutuo.biz.project.domain.ProjectAchievement">
        select
        A.*
        from biz_project_achievement A ,sys_dept B
        WHERE
        A.expand_company_id=B.dept_id
--         and
--         B.level=3
        and
        A.expand_company_id in
        (
        <foreach collection="companyIds" index="index" item="item" separator=",">
            #{item}
        </foreach>
        )
    </select>

    <select id="listBudgetInMonth" resultType="com.bytefinger.toutuo.biz.performance.domain.BudgetInMonth">
        select
        year_id yearId,
        field_key fieldKey,
        field_name fieldName,
        field_year fieldYear,
        SUM(field_value) fieldValue
        from biz_budget_in_month
        where
        record_id in (
        <foreach collection="recordIds" index="index" item="item" separator=",">
            #{item}
        </foreach>
        )
        and
        field_year = #{currYear}
        and
        field_key in (
        <foreach collection="fieldKeyList" index="index" item="item" separator=",">
            #{item}
        </foreach>
        )
        group by
        year_id ,
        field_key,
        field_name,
        field_year
          order by field_year,field_name
    </select>

    <select id="listProjectStep" resultType="com.bytefinger.toutuo.biz.performance.domain.BO.ProjectActualBO">
        SELECT
        bp.company_id as companyId,
        bp.project_no as projectNo,
        bp.sign_time as signTime,
        bp.contract_amount as contractAmount,
        bp.contract_annual_amount as contractAnnualAmount,
        bp.annual_conversion_amount as annualConversionAmount,
        bp.performance_confirm_time as performanceConfirmTime,
        bp.service_begin_time as serviceStarttime,
        bp.service_end_time as serviceEndtime,
        bp.proposed_service_period as proposedServicePeriod,
        bp.id
        FROM
        biz_project bp
        inner join biz_project_step step on bp.id = step.project_id
        inner join biz_project_step_menu stepmenu on step.step_menu_id = stepmenu.id
        WHERE  bp.in_stock = 'FOU'
        and bp.expire = 'YOU_XIAO'
        and bp.service_status not in ('YI_ZHONG_ZHI')
        and bp.source_id is null
        and bp.performance_confirm_time is not null
        and bp.project_type in('DAN_YI_FEI_TOU_BIAO_XIANG_MU','DAN_YI_TOU_BIAO_XIANG_MU')
        and step.`status` = 1
        and stepmenu.`code` = 'yjqrsp'
        <if test="cm.userId != null">
            AND (
            bp.attributor_user_id = #{cm.userId}
            OR bp.id IN ( SELECT bpt.record_id FROM biz_project_team bpt WHERE bpt.user_id = #{cm.userId})
            )
        </if>

        <if test="ew.sqlSegment != '' ">
            AND ${ew.sqlSegment}
        </if>
    </select>

    <select id="listTwo" resultType="com.bytefinger.toutuo.biz.project.bo.ProjectAchievementBO">
        <include refid="selectBaseDataTwo"></include>
        <if test="ew.sqlSegment != '' ">
            AND ${ew.sqlSegment}
        </if>
    </select>

    <!--    1.项目合同到期未及时处理-->
    <!--    2.项目未进行标书合规评审-->
    <!--    3.项目开标未及时复盘-->
    <select id="pageNotify" resultType="com.bytefinger.toutuo.biz.project.dto.ProjectNotifyDto">
        SELECT tabb.*,tabc.handle_time lxTime FROM biz_project_notify tabb
        left JOIN (select *from biz_project_notify_log where deleted = 0) taba
        ON tabb.project_id = taba.project_id AND tabb.notify_type = taba.notify_type
        left JOIN (select * from biz_project_step where step_menu_id = 13) tabc
        ON tabb.project_id = tabc.project_id
        WHERE 1=1 AND taba.id is null and tabb.deleted = 0
        <if test="cm.companyIds != null and cm.companyIds.size > 0">
            AND tabb.dept_id IN
            <foreach collection="cm.companyIds" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        ORDER BY tabb.project_name
    </select>

    <select id="allNotify" resultType="com.bytefinger.toutuo.biz.project.dto.ProjectNotifyDto">
        SELECT * FROM (
        SELECT DISTINCT pro.id,pro.project_name,'XIANG_MU_HE_TONG_DAO_QI_WEI_JI_SHI_CHU_LI' AS notifyType,TO_DAYS(now()) - TO_DAYS(pro.service_end_time)  AS overdueTime,dept.dept_id,dept.dept_name,pro.attributor_user_id,usr.realname AS attributorUserName, pro.service_end_time,DATE_ADD(pro.service_end_time, INTERVAL 10 DAY) AS pushTime
        FROM biz_project pro
        JOIN biz_project_step pros ON pro.id = pros.project_id
        JOIN sys_dept dept ON pro.company_id = dept.dept_id
        JOIN sys_user usr ON pro.attributor_user_id = usr.user_id
        WHERE pros.`status` = 1 AND pros.step_menu_id = 18 AND pro.expire = 'YOU_XIAO' AND pro.service_status = 'YI_DAO_QI'
        AND (TO_DAYS(now()) - TO_DAYS(pro.service_end_time) >= 14)
        -- AND pro.id NOT IN (SELECT project_id FROM biz_project_notify_log WHERE deleted = 0 AND notify_type = 'XIANG_MU_HE_TONG_DAO_QI_WEI_JI_SHI_CHU_LI')

        UNION

        SELECT DISTINCT pro.id,pro.project_name,'XIANG_MU_WEI_JIN_XING_BIAO_SHU_HE_GUI_PING_SHEN' AS notifyType,TO_DAYS(now()) - TO_DAYS(pro.biding_opentime) AS overdueTime,dept.dept_id,dept.dept_name,pro.attributor_user_id,usr.realname AS attributorUserName,pro.service_end_time,DATE_ADD(pro.biding_opentime, INTERVAL 3 DAY) AS pushTime
        FROM biz_project pro
        LEFT JOIN biz_project_step pros ON pro.id = pros.project_id
        JOIN sys_dept dept ON pro.company_id = dept.dept_id
        JOIN sys_user usr ON pro.attributor_user_id = usr.user_id
        WHERE
        ((pros.`status` = 0 AND pros.step_menu_id = 37) or
        (pro.id IN (
        SELECT DISTINCT project_id FROM biz_project_step WHERE project_id NOT IN
        (SELECT project_id FROM biz_project_step WHERE step_menu_id = 37 ) OR step_menu_id IS NULL
        )) OR pros.id IS NULL)
        AND pro.project_type = 'DAN_YI_TOU_BIAO_XIANG_MU' AND pro.expire = 'YOU_XIAO'
        AND (TO_DAYS(now()) - TO_DAYS(pro.biding_opentime) >= 3)
        -- AND pro.id NOT IN (SELECT project_id FROM biz_project_notify_log WHERE deleted = 0 AND notify_type = 'XIANG_MU_WEI_JIN_XING_BIAO_SHU_HE_GUI_PING_SHEN')

        UNION

        SELECT DISTINCT pro.id,pro.project_name,'XIANG_MU_KAI_BIAO_WEI_JI_SHI_FU_PAN' AS notifyType,TO_DAYS(now()) - TO_DAYS(pro.biding_opentime) AS overdueTime,dept.dept_id,dept.dept_name,pro.attributor_user_id,usr.realname AS attributorUserName,pro.service_end_time,DATE_ADD(pro.biding_opentime, INTERVAL 14 DAY) AS pushTime
        FROM biz_project pro
        LEFT JOIN biz_project_step pros ON pro.id = pros.project_id
        JOIN sys_dept dept ON pro.company_id = dept.dept_id
        JOIN sys_user usr ON pro.attributor_user_id = usr.user_id
        WHERE
        ((pros.`status` = 0 AND pros.step_menu_id = 14)
        or (pro.id IN (
        SELECT DISTINCT project_id FROM biz_project_step WHERE project_id NOT IN
        (SELECT project_id FROM biz_project_step WHERE step_menu_id = 14 ) OR step_menu_id IS NULL
        )) OR pros.id IS NULL)
        AND pro.project_type = 'DAN_YI_TOU_BIAO_XIANG_MU' AND pro.expire = 'YOU_XIAO'
        AND (TO_DAYS(now()) - TO_DAYS(pro.biding_opentime) >= 14)
        -- AND pro.id NOT IN (SELECT project_id FROM biz_project_notify_log WHERE deleted = 0 AND notify_type = 'XIANG_MU_KAI_BIAO_WEI_JI_SHI_FU_PAN')

        ) tab
        WHERE 1=1
    </select>


    <select id="pageEndNotify" resultType="com.bytefinger.toutuo.biz.project.dto.EndProjectNotifyDto">
        SELECT pro.id,dept.dept_id,dept.dept_name,pro.project_name,pro.contract_amount,
        CASE
            WHEN pro.service_status = 'YI_WAN_JIE' THEN '已完结'
            WHEN pro.service_status = 'YI_FEI_ZHI' THEN '已废止'
            WHEN pro.service_status = 'YI_TUI_CHANG' THEN '已退场'
        ELSE ''
        END AS serviceStatusName,pro.proposed_service_period ,pro.update_time,usr.realname AS updateUserName
        FROM biz_project pro
        JOIN sys_dept dept ON pro.company_id = dept.dept_id
        LEFT JOIN sys_user usr ON pro.update_user_id = usr.user_id
        WHERE pro.service_status IN ('YI_WAN_JIE','YI_FEI_ZHI','YI_TUI_CHANG')
        and YEAR(pro.update_status_date) = YEAR(CURDATE())
        ORDER BY dept.dept_name
    </select>

    <!--     查询40天未维护（最后更新时间40天没改过），并且项目评审节点未完成或者没有到项目评审这个节点的项目 -->
    <select id="expireProjectList" resultType="com.bytefinger.toutuo.biz.project.domain.Project">
        SELECT DISTINCT pro.id  from biz_project pro
        LEFT JOIN biz_project_step pros ON pro.id = pros.project_id
        WHERE
        ((pros.`status` = 0 AND pros.step_menu_id = 12) OR
        (pro.id IN (
            SELECT DISTINCT project_id FROM biz_project_step WHERE project_id NOT IN
            (SELECT project_id FROM biz_project_step WHERE step_menu_id = 12 ) OR step_menu_id IS NULL
        )) OR
        pros.id IS NULL)
        AND expire = 'YOU_XIAO'
        AND (TO_DAYS(now()) - TO_DAYS(pro.update_time) >= 40) AND TO_DAYS(now())- TO_DAYS(pro.update_time) >=0
    </select>

    <update id="updateProjectValid">
        UPDATE biz_project
        SET expire = 'YOU_XIAO',expire_time = null,expire_reason = null
        WHERE id = #{id}
    </update>

    <select id="selectProjectPerformance" resultType="com.bytefinger.toutuo.biz.performance.domain.BO.ProjectActualBO">
        select
            <if test="level != 1">
                DISTINCT
                bpad.contract_amount_rate,
                bpad.leading_expansion_rate,
            </if>
            bp.id,
            bp.project_type,
            bpad.incremental_amount,
            bpad.keep_amount,
            bpad.add_amount,
            bpad.incremental_amount_year,
            bpad.keep_amount_year,
            bpad.add_amount_year,
            (
                case when
                bp.in_stock = 'FOU'
                THEN bpad.currentConvertIncome
                ELSE 0
                END
             ) currentConvertIncome
        from
            biz_project bp
            left join biz_budget_performance_allocation_data bpad on bpad.project_id = bp.id and bpad.project_type = bp.project_type and deleted = 0 and bpad.field_year = #{year}
        where
            <!--#项目类型 -->
            bp.project_type in('DAN_YI_FEI_TOU_BIAO_XIANG_MU','DAN_YI_TOU_BIAO_XIANG_MU')
            <!-- #业绩确认时间 -->
            and DATE_FORMAT(bp.performance_confirm_time, '%Y') = #{year}
            <!--#有效 -->
            and bp.expire = 'YOU_XIAO'
            <!--#剔除已废止-->
            AND bp.service_status NOT IN ( 'YI_FEI_ZHI' )
            <!--剔除补录项目且计算业绩为否的项目 -->
            and bp.is_count_performance != 'FOU'
            <!--#项目流程 完成业绩确认节点-->
            and bp.id in (
                select
                  step.project_id id
                from
                  biz_project_step step
                  join biz_project_step_menu stepmenu on step.step_menu_id = stepmenu.id
                where
                  step.`status` = 1
                  AND stepmenu.`code` = 'yjqrsp'
            )

            <!--#拓展单位：选择的业务架构 -->
            <if test="recordId != null and level != 1">
                and bpad.company_id = #{recordId}
            </if>

        <if test="level == 1">
            GROUP BY bp.id
        </if>

    </select>

    <select id="selectProjectPerformanceYx" resultType="com.bytefinger.toutuo.biz.performance.domain.BO.ProjectActualBO">
        select
            bp.*
        from
          biz_project bp
        where
            <!--#项目类型 -->
            bp.project_type in('DAN_YI_FEI_TOU_BIAO_XIANG_MU','DAN_YI_TOU_BIAO_XIANG_MU')
            <!--是否有效：有效-->
            and bp.expire in ('YOU_XIAO')
            <!--是否续签项目：否-->
            AND bp.in_stock = 'FOU'
            <!--剔除补录项目且计算业绩为否的项目 -->
            and bp.is_count_performance != 'FOU'
            <!-- 项目流程：完成项目评审 节点  时间是选择时间-->
            AND bp.id in (
                select
                  step.project_id id
                from
                  biz_project_step step
                  join biz_project_step_menu stepmenu on step.step_menu_id = stepmenu.id
                where
                  step.`status` = 1 AND stepmenu.`code` = 'xmps' and DATE_FORMAT(step.handle_time , '%Y') = #{year}
            )

            <!--#归属单位：选择的业务架构 -->
            <if test="recordId != null ">
                and (
                    bp.company_id IN (
                        SELECT dept_id FROM sys_dept WHERE ancestors like concat('%',#{recordId}, '%') AND status = 0 AND del_flag = 0
                    )
                    OR
                    bp.company_id = #{recordId}
                )
            </if>

    </select>

    <select id="selectProjectMethodConfig" resultType="com.bytefinger.toutuo.biz.performance.domain.BO.ProjectMethodConfigBO">
        SELECT
            *
        FROM
            biz_budget_statistical_method_config
        WHERE
            field_year = #{year}
            AND field_key = #{fieldKey}
    </select>

    <select id="selectProjectPerformanceBl" resultType="com.bytefinger.toutuo.biz.performance.domain.BO.ProjectActualBO">
	-- 分子：单一投标/单一非投标  （项目来源是由 续签+重新投标 生成的），有效，年内完成结项   的数据
	-- 分母：单一投标/单一非投标  （项目来源是由 续签+重新投标 生成的），有效，年内完成结项   的数据 +  年内完成 (已退场+已完结) 的操作
    select
        ROUND( d.a / d.b * 100 ,2) retentionRate
    from
    (
        SELECT
            sum(case
                when
                    id in (
                        select
                          step.project_id id
                        from
                            biz_project_step step
                            join biz_project_step_menu stepmenu on step.step_menu_id = stepmenu.id
                        where
                            step.`status` = 1
                            AND stepmenu.`code` = 'xmjxps'
                            and DATE_FORMAT(step.handle_time, '%Y') = #{year}
                    )
                then 1
                else 0
            end) a ,-- 年内完成结项   的数据
            sum(case
                when
                    id in (
                        select
                            step.project_id id
                        from
                            biz_project_step step
                            join biz_project_step_menu stepmenu on step.step_menu_id = stepmenu.id
                        where
                            step.`status` = 1
                            AND stepmenu.`code` = 'xmjxps'
                            and DATE_FORMAT(step.handle_time, '%Y') = #{year}
                    )
                    or (
                        (service_status = 'YI_WAN_JIE' or service_status = 'YI_TUI_CHANG' )
                        and DATE_FORMAT(update_status_date , '%Y') = #{year}
                    )
                then 1
                else 0
            end) b  -- 年内完成结项  +  年内完成 (已退场+已完结) 的操作
        FROM
            biz_project
        WHERE
            -- 有效
            expire = 'YOU_XIAO'
            -- 单一投标/单一非投标
            and project_type in('DAN_YI_FEI_TOU_BIAO_XIANG_MU','DAN_YI_TOU_BIAO_XIANG_MU')
            <!--剔除补录项目且计算业绩为否的项目 -->
            and is_count_performance != 'FOU'
            -- 项目来源是由 续签+重新投标 生成的）
            and id in ( SELECT relevance_project_id FROM biz_project_extension WHERE process_mode IN ( 1, 2 ) AND process_state = 2 )

            <!--#归属单位：选择的业务架构 -->
            <if test="recordId != null ">
                and (
                company_id IN (
                SELECT dept_id FROM sys_dept WHERE ancestors like concat('%',#{recordId}, '%') AND status = 0 AND del_flag = 0
                )
                OR
                company_id = #{recordId}
                )
            </if>

    ) d
    </select>

    <select id="selectBudgetIndicatorData" resultType="com.bytefinger.toutuo.biz.performance.domain.BudgetIndicatorData">
        SELECT
            d.field_key,
            d.field_name,
            d.amount
        FROM
          biz_budget_indicator_data d
          JOIN biz_budget_indicator_config config ON config.`code` = d.`code`
        where
            config.is_target = 1
            and d.field_name != ''
            and d.field_name is not null
            and d.field_year = #{year}
            <if test="recordId != null">
                AND d.company_id  = #{recordId}
            </if>
        GROUP BY field_key
        order by d.field_sort asc
    </select>

    <select id="selectYdqList" resultType="com.bytefinger.toutuo.biz.performance.domain.dto.ProjectDaoQiDto">
        SELECT
            tab_a.project_id id,
            tab_m.project_type projectType,
            tab_m.bided_result bidedResult,
            tab_b.service_status serviceStatus
        FROM
            `biz_project_step` tab_a
                INNER JOIN biz_project tab_m ON tab_a.project_id = tab_m.id
                INNER JOIN biz_project_step_menu tab_b ON tab_a.step_menu_id = tab_b.id
                INNER JOIN biz_project_step_menu tab_c ON tab_b.parent_id = tab_c.id
        WHERE
            tab_a.`status` = 1 and tab_m.service_end_time > now()
          AND tab_m.service_status = 'YI_DAO_QI'
        ORDER BY
            tab_c.sorts DESC,tab_b.sorts desc
    </select>

    <select id="getProjectStepMenuList" resultType="com.bytefinger.toutuo.biz.performance.domain.vo.SelectCommonVo">
        select CONCAT(tab_b.`name` ,'-', tab_a.`name`) label,tab_a.id 'value' from biz_project_step_menu tab_a
        left join biz_project_step_menu tab_b on tab_a.parent_id = tab_b.id
        where tab_a.`level` = 2  and tab_a.parent_id != 1 and tab_b.id != 1 order by tab_b.sorts,tab_a.sorts asc;
    </select>

    <select id="getProjectListStep" resultType="com.bytefinger.toutuo.biz.performance.domain.vo.ProjectListStepVo">
        SELECT
            tab_c.project_id projectId,
            tab_a.id stepId,
            CONCAT( tab_b.`name`, '-', tab_a.`name` ) stepName
        FROM
            biz_project_step tab_c
                LEFT JOIN biz_project_step_menu tab_a ON tab_a.id = tab_c.step_menu_id
                LEFT JOIN biz_project_step_menu tab_b ON tab_a.parent_id = tab_b.id
        WHERE
            tab_a.`level` = 2
            AND tab_c.project_id in
            <foreach collection="ids" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
            AND tab_c.`status` = 1
        ORDER BY
            tab_b.sorts DESC,
            tab_a.sorts DESC
    </select>

    <select id="getOpenMarkList"  resultType="com.bytefinger.toutuo.biz.performance.domain.vo.ProjectOpenMarkExportVo">
        select
            tab_project.id,
            tab_deptRegion.dept_name 'regionName',
            tab_deptCompany.dept_name 'deptName',
            project_no 'projectNo',
            project_name 'projectName',
            tab_state.dict_label 'serviceStatus',
            tab_lx.dict_label 'projectType',
            tab_yetaip.dict_name 'ytPName',
            tab_yetai.dict_label 'ytName',
            biding_budget 'bidingBudget',
            in_stock 'inStock',
            tab_mode.dict_label 'expansionMode',
            tab_zb.dict_label 'bidingMode',
            sign_time 'signTime',
            proposed_service_period 'proposedServicePeriod',
            contract_amount 'contractAmount',
            contract_annual_amount 'contractAnnualAmount',
            annual_conversion_amount 'annualConversionAmount',
            tab_project.create_time 'createTime',
            tab_project.performance_confirm_time 'performanceConfirmTime',
            tab_sx.dict_label 'expire',
            biding_opentime 'bidingOpentime',
            bided_result 'bidedResult',
            tab_tpfp.handle_time 'bidedTime',
            tab_project.expect_service_years 'expectServiceYears',
            tab_project.bided_amount 'bidedAmount',
            not_selected_reason 'notSelectedReason',
            tab_project.bid_part_in_company 'bidPartInCompany',
            (case when tab_tpfp.id is not null then 1 else 0 end) 'isPassTbfp'
        from biz_project tab_project
                 left join (select * from biz_project_step where step_menu_id = 14 and status = 1) tab_tpfp on tab_project.id = tab_tpfp.project_id
                 left join sys_dept tab_deptRegion on tab_project.region_id = tab_deptRegion.dept_id
                 left join sys_dept tab_deptCompany on tab_project.company_id = tab_deptCompany.dept_id
                 left join (select * from sys_dict_data where dict_type = 'TUO_ZHAN_MO_SHI') tab_mode on tab_project.expansion_mode = tab_mode.dict_value
                 left join (select * from sys_dict_data where dict_type = 'XIANG_MU_ZHUANG_TAI') tab_state on tab_project.service_status = tab_state.dict_value
                 left join (select * from sys_dict_data where dict_type = 'XIANG_MU_SHI_XIAO_ZHUANG_TAI') tab_sx on tab_project.expire = tab_sx.dict_value
                 left join (select * from sys_dict_data where dict_type = 'XIANG_MU_LEI_XING') tab_lx on tab_project.project_type = tab_lx.dict_value
                 left join (select * from sys_dict_data where dict_type = 'ZHAO_BIAO_LEI_XING') tab_zb on tab_project.biding_mode = tab_zb.dict_value
                 left join (select * from sys_dict_data where dict_type like '%XIANG_MU_YE_TAI%' and dict_type != 'XIANG_MU_YE_TAI') tab_yetai on tab_project.business_type = tab_yetai.dict_value
                 left join (select * from sys_dict_type where dict_ptype = 'XIANG_MU_YE_TAI') tab_yetaip on tab_yetai.dict_type = tab_yetaip.dict_type
        where project_type = 'DAN_YI_TOU_BIAO_XIANG_MU'
        <if test="cm.currYear != null">
            AND date_format(tab_project.biding_opentime, '%Y') = #{cm.currYear}
        </if>
        order by tab_project.create_time desc
    </select>

    <insert id="reinsert">
        insert into biz_project(
            id,
            source_id,
            source_name,
            project_name,
            project_no,
            region_id,
            company_id,
            team_id,
            project_level,
            attributor_user_id,
            expansion_mode,
            project_type,
            bided,
            cooperation_mode,
            cooperation_type,
            cooperation_type_other,
            in_stock,
            business_type,
            service_content,
            service_content_other,
            customer_id,
            construction_area,
            province_code,
            city_code,
            area_code,
            street_code,
            address,
            approach_time,
            keywords,
            biding_no,
            biding_mode,
            biding_publishtime,
            biding_company,
            biding_company_contact,
            biding_company_phone,
            biding_website,
            biding_agency,
            biding_agency_contact,
            biding_agency_phone,
            biding_endtime,
            biding_opentime,
            biding_budget,
            bt_apply,
            tender_amount,
            biding_amount,
            bided_result,
            bided_company,
            bided_amount,
            bided_remark,
            dd_mode,
            dd_amount,
            create_user_id,
            bid_part_in_company,
            create_time,
            update_user_id,
            update_time,
            follow_time,
            sign_dept_id,
            charge_dept_id,
            operation_dept_id,
            entrusted_cooperation_mode,
            first_capital_amount,
            first_capital_time,
            parking_number,
            operation_team_id,
            principal_id,
            handover_date,
            first_responsible_company,
            first_responsible_name,
            first_responsible_post,
            first_responsible_phone,
            handover_person,
            handover_post,
            handover_phone,
            enter_time,
            discounts_desc,
            service_desc,
            main_clause,
            risk_warning,
            wechat_friends,
            interviewed,
            other_desc,
            contract_amount,
            contract_annual_amount,
            annual_conversion_amount,
            calculate_profit_rate,
            sign_time,
            service_begin_time,
            service_end_time,
            proposed_service_period,
            expire,
            service_status,
            termination_time,
            termination_sponsor,
            termination_reason,
            termination_document,
            expire_time,
            expire_reason,
            condition_explain,
            business_dept_id,
            business_dept_name,
            dd_team_type,
            collection_rate_first,
            collection_rate_second,
            collection_rate_third,
            performance_confirm_time,
            renewal,
            target_company_name,
            target_company_no,
            target_company_type,
            target_registered_capital,
            target_incorporation_address,
            target_incorporation_time,
            target_business_type,
            target_legal_representative,
            target_personnel,
            target_introduce,
            remark,
            sync_company_process,
            relevance_project_id,
            stamp_category,
            not_selected_reason,
            invalid_bid_reason,
            other_invalid_bid_beason,
            is_performance_increment,
            annual_conversion_amounts,
            contract_annual_amounts,
            contract_amounts,
            key_focus_project,
            other_description,
            bid_type,
            application_type,
            related_seal_type,
            is_sync_operation,
            is_in_management,
            update_status_date,
            reimbursement,
            expect_service_years
        )values (
                #{id},
                #{sourceId},
                #{sourceName},
                #{projectName},
                #{projectNo},
                #{regionId},
                #{companyId},
                #{teamId},
                #{projectLevel},
                #{attributorUserId},
                #{expansionMode},
                #{projectType},
                #{bided},
                #{cooperationMode},
                #{cooperationType},
                #{cooperationTypeOther},
                #{inStock},
                #{businessType},
                #{serviceContent},
                #{serviceContentOther},
                #{customerId},
                #{constructionArea},
                #{provinceCode},
                #{cityCode},
                #{areaCode},
                #{streetCode},
                #{address},
                #{approachTime},
                #{keywords},
                #{bidingNo},
                #{bidingMode},
                #{bidingPublishtime},
                #{bidingCompany},
                #{bidingCompanyContact},
                #{bidingCompanyPhone},
                #{bidingWebsite},
                #{bidingAgency},
                #{bidingAgencyContact},
                #{bidingAgencyPhone},
                #{bidingEndtime},
                #{bidingOpentime},
                #{bidingBudget},
                #{btApply},
                #{tenderAmount},
                #{bidingAmount},
                #{bidedResult},
                #{bidedCompany},
                #{bidedAmount},
                #{bidedRemark},
                #{ddMode},
                #{ddAmount},
                #{createUserId},
                #{bidPartInCompany},
                #{createTime},
                #{updateUserId},
                #{updateTime},
                #{followTime},
                #{signDeptId},
                #{chargeDeptId},
                #{operationDeptId},
                #{entrustedCooperationMode},
                #{firstCapitalAmount},
                #{firstCapitalTime},
                #{parkingNumber},
                #{operationTeamId},
                #{principalId},
                #{handoverDate},
                #{firstResponsibleCompany},
                #{firstResponsibleName},
                #{firstResponsiblePost},
                #{firstResponsiblePhone},
                #{handoverPerson},
                #{handoverPost},
                #{handoverPhone},
                #{enterTime},
                #{discountsDesc},
                #{serviceDesc},
                #{mainClause},
                #{riskWarning},
                #{wechatFriends},
                #{interviewed},
                #{otherDesc},
                #{contractAmount},
                #{contractAnnualAmount},
                #{annualConversionAmount},
                #{calculateProfitRate},
                #{signTime},
                #{serviceBeginTime},
                #{serviceEndTime},
                #{proposedServicePeriod},
                #{expire},
                #{serviceStatus},
                #{terminationTime},
                #{terminationSponsor},
                #{terminationReason},
                #{terminationDocument},
                #{expireTime},
                #{expireReason},
                #{conditionExplain},
                #{businessDeptId},
                #{businessDeptName},
                #{ddTeamType},
                #{collectionRateFirst},
                #{collectionRateSecond},
                #{collectionRateThird},
                #{performanceConfirmTime},
                #{renewal},
                #{targetCompanyName},
                #{targetCompanyNo},
                #{targetCompanyType},
                #{targetRegisteredCapital},
                #{targetIncorporationAddress},
                #{targetIncorporationTime},
                #{targetBusinessType},
                #{targetLegalRepresentative},
                #{targetPersonnel},
                #{targetIntroduce},
                #{remark},
                #{syncCompanyProcess},
                #{relevanceProjectId},
                #{stampCategory},
                #{notSelectedReason},
                #{invalidBidReason},
                #{otherInvalidBidBeason},
                #{isPerformanceIncrement},
                #{annualConversionAmounts},
                #{contractAnnualAmounts},
                #{contractAmounts},
                #{keyFocusProject},
                #{otherDescription},
                #{bidType},
                #{applicationType},
                #{relatedSealType},
                #{isSyncOperation},
                #{isInManagement},
                #{updateStatusDate},
                #{reimbursement},
                #{expectServiceYears}

        )
    </insert>

    <select id="listAll" resultType="com.bytefinger.toutuo.biz.project.domain.Project">
        <include refid="selectBaseDataAll"></include>
        <if test="ew.sqlSegment != '' ">
            AND ${ew.sqlSegment}
        </if>
    </select>

    <update id="updateCreateUserId">
        update
        biz_project
        set
        create_user_id=#{userId},
        update_user_id=#{userId}
        where
        id=#{id};
    </update>

    <update id="updateTime">
        update
        biz_project
        set create_time=#{createTime},
        update_time=#{updateTime}
        where
        id=#{id}
    </update>
</mapper>
