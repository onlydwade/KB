<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><mapper namespace="com.bytefinger.toutuo.biz.performance.mapper.PerformanceMapper">    <select id="groupInData" resultType="com.bytefinger.toutuo.biz.performance.domain.BO.PerformanceList">        SELECT            bbiy.field_key fieldKey,            SUM( bbiy.field_value ) yFieldValue,            SUM( bbim.field_value ) mFieldValue,            bbim.field_name fieldName        FROM            biz_budget_in_year bbiy                INNER JOIN biz_budget_in_month bbim ON ( bbiy.id = bbim.year_id )        WHERE            bbiy.field_year = #{currYear}            AND bbiy.record_id IN            <foreach collection="ids" index="index" item="item" open="(" separator="," close=")">                #{item}            </foreach>        GROUP BY            bbiy.field_key,            bbim.field_name    </select>    <select id="statisticsInData" resultType="com.bytefinger.toutuo.biz.performance.domain.BO.PerformanceList">        SELECT        bbiy.field_key fieldKey,        SUM( bbiy.field_value ) yFieldValue,        SUM( bbim.field_value ) mFieldValue,        bbim.field_name fieldName        FROM        biz_budget_in_year bbiy        INNER JOIN biz_budget_in_month bbim ON ( bbiy.id = bbim.year_id )        WHERE        bbiy.field_year = #{currYear}        AND bbiy.record_id IN        <foreach collection="ids" index="index" item="item" open="(" separator="," close=")">            #{item}        </foreach>        <if test="currMonth != null and currMonth != ''">            AND  bbim.field_month = #{currMonth}        </if>        <if test="fieldKey != null and fieldKey != ''">            AND  bbiy.field_key = #{fieldKey}        </if>        <if test="level != null and level != ''">            AND  bbiy.level = #{level}        </if>        GROUP BY        bbiy.field_key,        bbim.field_name        LIMIT 1;    </select>    <select id="groupOutData" resultType="com.bytefinger.toutuo.biz.performance.domain.BO.PerformanceList">        SELECT            bbiy.field_key fieldKey,            SUM( bbiy.field_value ) yFieldValue,            SUM( bbim.field_value ) mFieldValue,            bbim.field_name fieldName        FROM            biz_budget_out_year bbiy                INNER JOIN biz_budget_out_month bbim ON ( bbiy.id = bbim.year_id )        WHERE            bbiy.field_year = #{currYear}            AND bbiy.record_id IN            <foreach collection="ids" index="index" item="item" open="(" separator="," close=")">                #{item}            </foreach>        GROUP BY            bbiy.field_key,            bbim.field_name    </select>    <select id="currMothTotal" resultType="com.bytefinger.toutuo.biz.performance.domain.vo.CurrMothTotalVo">        SELECT            bp.attributor_user_id userId,            SUM(bpa.amount_tex_income) AS currMonthSum,            COUNT(bpa.amount_tex_income) currMonthTotal,            DATE_FORMAT( now(), '%Y%m' ) currMonth        FROM            biz_project_agreement bpa,            biz_project bp        WHERE            bp.id = bpa.project_id          AND bp.attributor_user_id = #{userId}          AND bpa.sign_time IS NOT NULL          AND bpa.amount_tex_income IS NOT NULL          AND DATE_FORMAT( bpa.sign_time, '%Y%m' ) = DATE_FORMAT(now(),'%Y%m')        GROUP BY bp.attributor_user_id    </select>    <select id="currYearTotal" resultType="com.bytefinger.toutuo.biz.performance.domain.vo.CurrYearTotalVO">        SELECT            bp.attributor_user_id userId,            SUM( bpa.amount_tex_income ) AS currYearTotal,            DATE_FORMAT( now(), '%Y' ) currYear,            COUNT( bpa.amount_tex_income ) currYearSum        FROM            biz_project_agreement bpa,            biz_project bp        WHERE            bp.id = bpa.project_id          AND bp.attributor_user_id = #{userId}          AND DATE_FORMAT( bpa.sign_time, '%Y' ) = #{currYear}        GROUP BY bp.attributor_user_id    </select>    <select id="getSJBBSRTotalByProjectId" resultType="java.util.Map">        SELECT SUM(field_value) AS SJBBSR FROM biz_actual_in_month  WHERE field_key = 'SJBBSR' AND record_id = #{recordId}    </select>    <!--统计今日线索 -->    <select id="StatisticalLeadDays" resultType="com.bytefinger.toutuo.biz.performance.domain.vo.HeadStatisticalVO">        SELECT COUNT(attributor_user_id) leadCurryDays , attributor_user_id  FROM biz_lead WHERE attributor_user_id = #{userId} AND DATE_FORMAT( claim_time, '%Y%m%d' ) = DATE_FORMAT(now(),'%Y%m%d')    </select>    <!--统计累计线索 -->    <select id="StatisticalLead" resultType="com.bytefinger.toutuo.biz.performance.domain.vo.HeadStatisticalVO">        SELECT COUNT(attributor_user_id) leadCount , attributor_user_id  FROM biz_lead WHERE attributor_user_id = #{userId}    </select>    <!--统计今日商机 -->    <select id="StatisticalOpportunityDays" resultType="com.bytefinger.toutuo.biz.performance.domain.vo.HeadStatisticalVO">        SELECT COUNT(attributor_user_id) opportunityCurrDays, attributor_user_id FROM biz_opportunity WHERE attributor_user_id = #{userId} AND DATE_FORMAT( create_time, '%Y%m%d' ) = DATE_FORMAT(now(),'%Y%m%d')    </select>    <!--统计累计商机 -->    <select id="StatisticalOpportunity" resultType="com.bytefinger.toutuo.biz.performance.domain.vo.HeadStatisticalVO">        SELECT COUNT(attributor_user_id) opportunityCount , attributor_user_id FROM biz_opportunity WHERE attributor_user_id = #{userId}    </select>    <!--统计今日签约 -->    <select id="StatisticalAgreementDays" resultType="com.bytefinger.toutuo.biz.performance.domain.vo.HeadStatisticalVO">        SELECT SUM(bpa.amount_tex_income) AS agreementDaysAmount,COUNT(bpa.amount_tex_income)agreementDaysNum,bp.attributor_user_id FROM biz_project_agreement bpa,biz_project bp WHERE bp.id = bpa.project_id AND bp.attributor_user_id = #{userId} AND bpa.sign_time IS NOT NULL  AND bpa.amount_tex_income IS NOT NULL        AND DATE_FORMAT( bpa.sign_time, '%Y%m%d' ) = DATE_FORMAT(now(),'%Y%m%d') GROUP BY bp.attributor_user_id    </select>    <!--归属于我的统计累计签约 -->    <select id="StatisticalAgreement" resultType="com.bytefinger.toutuo.biz.performance.domain.vo.HeadStatisticalVO">        SELECT            SUM( bpa.amount_tex_income ) AS agreementAmount,            COUNT(bpa.amount_tex_income ) AS agreementNum        FROM            biz_project_agreement bpa,            biz_project bp        WHERE            bp.id = bpa.project_id          AND bp.attributor_user_id = #{userId} AND bpa.sign_time IS NOT NULL  AND bpa.amount_tex_income IS NOT NULL        <if test="currYear != null and currYear != ''">            AND DATE_FORMAT( bpa.sign_time, '%Y' ) = #{currYear}        </if>        GROUP BY            bp.attributor_user_id    </select>    <!--我参与的项目的统计累计签约 -->    <select id="StatisticalAgreementParticipation" resultType="com.bytefinger.toutuo.biz.performance.domain.vo.HeadStatisticalVO">        SELECT        SUM( bpa.amount_tex_income ) AS agreementAmount        FROM        biz_project_agreement bpa,        biz_project bp,        biz_project_user bou        WHERE        bp.id = bpa.project_id        AND bp.id = bou.record_id        AND bou.user_id = #{userId}        AND bpa.sign_time IS NOT NULL        AND bpa.amount_tex_income IS NOT NULL        <if test="currYear != null and currYear != ''">            AND DATE_FORMAT( bpa.sign_time, '%Y' ) = #{currYear}        </if>    </select>    <select id="getLeadCount" resultType="java.lang.Integer">        SELECT count(1) FROM biz_lead WHERE attributor_user_id = #{userid} and DATE_FORMAT(claim_time,'%Y%m')=DATE_FORMAT(CURDATE(),'%Y%m');    </select>    <select id="getOpportunityCount" resultType="java.lang.Integer">        SELECT COUNT(1)  FROM biz_opportunity WHERE attributor_user_id = #{userid} AND DATE_FORMAT( create_time, '%Y%m' ) = DATE_FORMAT(CURDATE(),'%Y%m')    </select>    <select id="getAgreementCount" resultType="java.lang.Integer">        SELECT            COUNT(1)        FROM            biz_project_agreement bpa,            biz_project bp        WHERE            bp.id = bpa.project_id            AND bp.attributor_user_id = #{userid}            AND bpa.sign_time IS NOT NULL            AND bpa.amount_tex_income IS NOT NULL            AND DATE_FORMAT( bpa.sign_time, '%Y%m' ) = DATE_FORMAT(CURDATE(), '%Y%m')        GROUP BY            bp.attributor_user_id    </select>    <select id="getCustomerCount" resultType="java.lang.Integer">        select COUNT(1) from biz_customer where create_user_id = #{userid} and DATE_FORMAT(create_time ,'%Y%m')=DATE_FORMAT(CURDATE(),'%Y%m') and deleted = 0    </select>    <select id="getProjectCount" resultType="java.lang.Integer">        SELECT COUNT(1) from biz_project where attributor_user_id  = #{userid} and DATE_FORMAT(create_time ,'%Y')=DATE_FORMAT(CURDATE(),'%Y')    </select>    <update id="lockedIndicator">        update ${tableName} set locked = #{locked} where company_id = #{recordId} AND field_year = #{currYear}    </update>    <update id="locked">        update ${tableName} set locked = #{locked} where record_id = #{recordId} AND field_year = #{currYear}    </update>    <select id="getProjectIdByUser" resultType="com.bytefinger.toutuo.biz.project.domain.Project">        SELECT DISTINCT            project.*        FROM            biz_project project                LEFT JOIN biz_project_agreement bpa ON project.id = bpa.project_id        WHERE            project.attributor_user_id = #{userId} AND DATE_FORMAT(bpa.sign_time, '%Y' ) = #{currYear}    </select>    <select id="getProjectIdByUserParticipation" resultType="com.bytefinger.toutuo.biz.project.domain.Project">        SELECT DISTINCT            project.*        FROM            biz_project project                INNER JOIN biz_project_user bou ON ( project.id = bou.record_id )                INNER JOIN biz_project_agreement bpa ON (project.id = bpa.project_id )        WHERE            bou.user_id = #{userId} AND DATE_FORMAT(bpa.sign_time, '%Y' ) = #{currYear}    </select>    <select id="getDictData" resultType="com.bytefinger.toutuo.api.system.core.domain.SysDictData">        SELECT * FROM sys_dict_data sda WHERE sda.dict_value = #{dictValue}        LIMIT 1    </select></mapper>