package com.bytefinger.toutuo.biz.companyrisk.service.impl;import com.baomidou.mybatisplus.extension.plugins.pagination.Page;import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;import com.bytefinger.common.das.domain.vo.QueryPage;import com.bytefinger.common.security.annotation.DataFill;import com.bytefinger.toutuo.biz.companyrisk.domain.ProjectCompanyRiskInspection;import com.bytefinger.toutuo.biz.companyrisk.mapper.ProjectCompanyRiskInspectionMapper;import com.bytefinger.toutuo.biz.companyrisk.service.IProjectCompanyRiskInspectionService;import com.bytefinger.toutuo.biz.projectcompany.domain.ProjectCompany;import com.bytefinger.toutuo.biz.projectcompany.mapper.ProjectCompanyMapper;import com.bytefinger.toutuo.common.enums.ModuleType;import com.bytefinger.toutuo.common.service.SendMessageService;import lombok.AllArgsConstructor;import org.springframework.stereotype.Service;import org.springframework.util.CollectionUtils;import java.util.List;/** * <p> * 子公司-风险检查 服务实现类 * </p> * * @author Jone * @since 2023-03-17 */@Service@AllArgsConstructorpublic class ProjectCompanyRiskInspectionServiceImpl extends ServiceImpl<ProjectCompanyRiskInspectionMapper, ProjectCompanyRiskInspection> implements IProjectCompanyRiskInspectionService {    private final ProjectCompanyRiskInspectionMapper projectCompanyRiskInspectionMapper;    private final ProjectCompanyMapper projectCompanyMapper;    private SendMessageService sendMessageService;    @Override    public void sendNotifyTask() {        List<ProjectCompanyRiskInspection> list = projectCompanyRiskInspectionMapper.listByReminderTime();        if(CollectionUtils.isEmpty(list) || list.size() == 0){            return;        }        list.forEach(v -> {            ProjectCompany company = projectCompanyMapper.selectById(v.getCompanyId());            sendMessageService.sendMessage(company.getPrincipalId(), company.getId(), v.getNode(), v.getContent(),                    ModuleType.COMPANY.getCode(), "XI_TONG_TONG_ZHI" + "," + "DAI_BAN_TONG_ZHI");        });    }    @Override    @DataFill    public Page<ProjectCompanyRiskInspection> page(QueryPage queryPage) {        return projectCompanyRiskInspectionMapper.list(queryPage.toPage(), queryPage.getWrapper(), queryPage.getDbParams());    }    @Override    @DataFill    public ProjectCompanyRiskInspection getById(Long id) {        return projectCompanyRiskInspectionMapper.getById(id);    }}