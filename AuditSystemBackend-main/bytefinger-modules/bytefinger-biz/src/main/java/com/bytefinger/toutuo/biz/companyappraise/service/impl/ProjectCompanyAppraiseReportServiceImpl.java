package com.bytefinger.toutuo.biz.companyappraise.service.impl;import com.baomidou.mybatisplus.extension.plugins.pagination.Page;import com.bytefinger.common.core.service.ThisService;import com.bytefinger.common.das.domain.vo.QueryPage;import com.bytefinger.common.security.annotation.DataFill;import com.bytefinger.toutuo.biz.companyappraise.domain.ProjectCompanyAppraiseReport;import com.bytefinger.toutuo.biz.companyappraise.mapper.ProjectCompanyAppraiseReportMapper;import com.bytefinger.toutuo.biz.companyappraise.service.IProjectCompanyAppraiseReportService;import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;import com.bytefinger.toutuo.biz.companydocument.domain.ProjectCompanyDocumentTemplate;import com.bytefinger.toutuo.biz.companyfinance.domain.ProjectCompanyPayment;import com.bytefinger.toutuo.biz.project.service.impl.ProjectServiceImpl;import com.bytefinger.toutuo.common.service.BizService;import lombok.AllArgsConstructor;import org.springframework.stereotype.Service;import org.springframework.util.CollectionUtils;import org.springframework.util.StringUtils;import java.util.ArrayList;import java.util.Iterator;import java.util.List;/** * <p> * 评价报告 服务实现类 * </p> * * @author Jone * @since 2023-03-17 */@Service@AllArgsConstructorpublic class ProjectCompanyAppraiseReportServiceImpl extends BizService<ProjectCompanyAppraiseReportMapper, ProjectCompanyAppraiseReport> implements IProjectCompanyAppraiseReportService, ThisService<ProjectCompanyAppraiseReportServiceImpl> {    private ProjectCompanyAppraiseReportMapper projectCompanyAppraiseReportMapper;    @Override    public ProjectCompanyAppraiseReport getById(Long id) {        return projectCompanyAppraiseReportMapper.getById(id);    }    @Override    @DataFill    public Page<ProjectCompanyAppraiseReport> page(QueryPage queryPage) {        return projectCompanyAppraiseReportMapper.list(queryPage.toPage(), queryPage.getWrapper(), queryPage.getDbParams());    }    @Override    @DataFill    public Page<ProjectCompanyAppraiseReport> page(Long stepMenuId, QueryPage queryPage) {        Page<ProjectCompanyAppraiseReport> page = projectCompanyAppraiseReportMapper.list(queryPage.toPage(), queryPage.getWrapper(), queryPage.getDbParams());        if(CollectionUtils.isEmpty(page.getRecords())){            return page;        }        super.dataFillDcoument(stepMenuId, page);        List<ProjectCompanyAppraiseReport> records = page.getRecords();        for (ProjectCompanyAppraiseReport record : records) {            String reportMethod = record.getReportMethod();            List<ProjectCompanyDocumentTemplate> documentTemplateList = record.getDocumentTemplateList();            List<String> documentTypeOneList = new ArrayList<>();            documentTypeOneList.add("CAIWU_BAOGAO");            documentTypeOneList.add("DIAOYAN_BAOGAO");            documentTypeOneList.add("JINYIN_BAOGAO");            List<String> documentTypeTwoList = new ArrayList<>();            documentTypeTwoList.add("BAOGAO_SHANGCHUAN");            documentTypeTwoList.add("BAOGAO_SHANGCHUAN");            if (StringUtils.isEmpty(reportMethod) || CollectionUtils.isEmpty(documentTemplateList)){                continue;            }            Iterator<ProjectCompanyDocumentTemplate> iterator = documentTemplateList.iterator();            while (iterator.hasNext()){                String type = iterator.next().getType();                if ("SHANG_CHAUNG_BAO_GAO".equals(reportMethod) && documentTypeOneList.contains(type)){                    iterator.remove();                }                //&& documentTypeTwoList.contains(type)                if ("XIAN_SHANG_JI_LU".equals(reportMethod) ){                    iterator.remove();                }            }        }        return page;    }}